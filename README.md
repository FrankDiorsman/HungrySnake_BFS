# HungrySnake_BFS

利用图搜索技术实现基于启发式搜索的贪吃蛇游戏，其中，可以根据游戏中的设置进行计算机自动求解或者通过游戏快捷键控制贪吃蛇的移动，实现游戏的正常进行。
启发式搜索又叫做有信息搜索，该算法利用所求解问题相关辅助信息引导搜索过程，减少搜索范围，降低问题复杂度。与广度优先搜索和深度优先搜索策略这类无信息搜索算法不同，有信息搜索算法能够获得中间额外信息参与计算。启发式搜索算法在使用计算过程中需要满足三个条件，一是定义启发函数，在求解起点与目标点的最短距离中，计算和估计当前点到达目标点的代价；二是定义评价函数，根据搜索算法的不同而具有明显差异，用于选择最佳的边缘节点；三是辅助信息，计算目标点与当前节点的最短距离，当作额外搜索启发信息。
有信息搜索的最佳优先搜索算法是根据评估函数，对每个节点预测期望值，且每次搜索时，优先拓展期望值最大的节点，其最具代表性的是贪婪最佳优先搜索和A^*搜索两种算法。贪婪最佳优先算法是一种很基础简单的启发式搜索算法，其基本思想是将节点表按照距目标的距离进行排序，再以节点的估计距离为标准选择待扩展节点，评价函数即为启发函数，搜索问题解法的时候，每一步算法会先看所有邻近节点，选择最低开销，该算法的弊端是不一定是最优解、容易陷入死循环；基于贪婪最佳优先算法进行改进得到的A^*算法，是求解最短路径最有效的直接式搜索方法，算法的评价函数为当前的最小开销代价与后续最小开销代价的总和，该算法的设计需要满足两个条件，一是估计代价要小于实际代价，二是后续节点的代价应小于当前节点代价的单调性。
启发式搜索的辅助信息为评估总损失的评价函数。在寻路任务中，两点之间的直线距离为启发函数，计算从节点n到目标节点之间所形成路径的最小代价值，我们将评估函数命名为f，那么它可能是完整解的路径耗散，也可能是当前解到目标节点的路径耗散，贪婪最佳优先算法的表达为：
f(x)=g(x)
 A^*算法的公式表达为：
f(x)=g(x)+h(x)
其中h(x)就是启发式函数。


本游戏基于贪心算法，是一种简单启发式算法，它企图寻求局部最优解，容易陷入局部最优的困境，本次作业对贪婪最佳优先算法进行改进，为了寻找蛇S1的最佳方向D，具体流程为：
表1 蛇行进的方向处理算法
步骤	算法流程
步骤a	构造从蛇S1到水果的最短路P1，如果P1存在，则执行步骤b，否则执行步骤d
步骤b	构造一条虚拟蛇S2，让S2前行并吃水果
步骤c	构造蛇P2从蛇头到蛇尾的最长路P2，如果P2存在，则D就是P1的第一个方向，否则执行步骤d
步骤d	计算S1从蛇头到蛇尾的最长路P3，如果P3存在，则D就是P3的第一个方向，否则，执行步骤e
步骤e	D为远离水果的方向
同时，对贪吃蛇游戏规则本身做了修改，允许同时初始化两个水果于界面中；当蛇头与蛇尾不可到达时，采用最远距离行进策略以防止贪心算法陷入局部最优，导致最终游戏结束；当蛇头与蛇尾可以到达时，采用启发式搜索的改进贪婪最佳优先算法进行最近水果的路线搜索。
表2 贪吃蛇游戏处理流程
步骤	处理流程
步骤a	构造3个单位长度的蛇S1，两个单位长度水果F1和F2
步骤b	在蛇头与水果之间计算曼哈顿距离，搜索到距离最近的水果，并朝向该水果F进行前进
步骤c	判断蛇头与蛇尾的可达性，确定采用最远距离还是最近距离进行路线规划
步骤d	构造一条虚拟蛇S2，搜索行进方向D，让S2前行并吃水果F
步骤e	当蛇头的坐标等于水果坐标，重新生成1个新水果F’，返回步骤b
步骤f	继续运行，若蛇头与身体接触或触碰到边缘，游戏结束
在工程化实现代码中，主要参考网上的成熟实现代码框架，根据具体的同时出现两个苹果及最短路径判别需求和改进搜索算法设计进行了修改和代码增加。
在贪吃蛇框架代码中，主文件Main.py，该文件调用了其他所有的文件，是玩家直接运行的程序，使用Snake类和Fruit类存储了地图信息，使用Pygame绘制了游戏窗口，使用SnakeDrawer和FruitDrawer为不断变化的snake和fruit更新绘制图像。同时，Pygame负责监听键盘事件，响应玩家的操控。
游戏类 snake.py和fruit.py存储了贪吃蛇和水果的内部状态。
pather.py是寻路类的主要模块，其中的类PathSolve是辅助工具，用于求出蛇头距离水果的最短路，以及蛇头距离水果和蛇尾的最长路。PathSolve 使用了改进贪婪最佳优先算法得到最短路径。
另外，为实现自动程序运行和人工控制运行，在Config文件中添加配置字段，可设置两种模式运行。


在该算法的设计仿真过程中，曾把寻找最短路径的改进贪婪最佳优先算法替换为A^*算法和无信息搜索的广度优先的Dijkstra算法，固定两个水果的初始化位置，发现二者的搜索路径差别不大。
经过查阅资料得知，Dijkstra算法也是一种广度优先遍历（BFS）算法，使用了优先级队列，每次从队列中取出到起点路径最短的点优先遍历。使用优先级队列和使用普通队列的区别是，普通队列是拥有相同深度（同层）的节点同时遍历，而使用优先级队列是拥有相同路径长度（同权）的节点同时遍历，如果所有节点之间移动的代价（权）是相等的，则Dijkstra就退化为BFS算法，Dijkstra算法在更新的过程中是无方向的，就是更新的过程与终点无关，而改进贪婪最佳优先算法则以预估代价的方式将终点加入到总体代价中，这样更新的过程优化算法就有一个明显的指向性。
造成搜索路径差别不大的主要原因经过思考觉得可能与既定的搜索范围也就是总窗口大小不大有关，并且在游戏格中加入了两个水果，更加缩短了贪吃蛇对水果搜索的区域范围。
